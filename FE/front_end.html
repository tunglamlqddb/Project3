<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
            integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
            crossorigin="anonymous"
        />
    </head>
<body>
    <div class="form-group">

        <label for="level"> Choose topic of journal</label> 
        <select name="journal" id="journal">
            <option value="21">Biophysical Journal</option>
            <option value="22">Journal of Molecular Biology</option>
            <option value="23">Chemical Physics Letters</option>
            <option value="24">Biochemical and Biophysical Research Communications</option>
        </select> <br/>

        <label for="NumberOfRecords">Number Records</label>
        <input
            type="number"
            class="form-control is-valid"
            id="inputSuccess"
            placeholder="Enter ..."
        />
    </div>
    <button onclick="query()">Query</button> <br/>
    <button onclick="create_co_authors()">Create co authors table</button> <br/>
    
    <label for="level"> Choose level of potential co author</label> 
    <select name="level" id="level">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
    </select> <br/>

    <button onclick="create_potential_co_authors()">Create potential co authors table</button> <br/>
    
    <select name="weight_type" id="weight_type">
        <option value="unweighted">unweighted</option>
        <option value="weighted">weighted</option>
    </select> <br/>

    <select name="label_type" id="label_type" onclick="show_time_slice()">
        <option value="dynamic">dynamic</option>
        <option value="static" >static</option>
    </select> 
    <input
        type="number"
        class="form-control"
        id="time_slice"
        placeholder="Enter time slice for static labeling ..."
        style="display: none;"
    />

    <button onclick="calculate_scores_and_label()">Calculate scores</button>

    <p id='result1'></p>
    <p id='result2'></p>
    <p id='result3'></p>
</body>

    <script>

        function show_time_slice() {
            label_type = document.getElementById("label_type").value;
            if (label_type == "static") {   
                document.getElementById("time_slice").style.display = "block";                
            }
            else {
                document.getElementById("time_slice").style.display = "none";
            }
        }

        function query() {
            const num_records = document.getElementById('inputSuccess').value;
            const topic = document.getElementById('journal').value;
            fetch("http://127.0.0.1:5000/query", {
                method: 'POST',
                body: JSON.stringify({"num_records" : num_records, "topic" : topic}),
                headers: {'Content-Type': 'application/json',
                        "Access-Control-Allow-Origin": "*"
                }
            }).then(res => res.json())
            .then(result => {
                console.log("so luong paper", result['paper'][1].length)
                console.log("so luong author", result['author'][1].length)
                console.log("so luong paper_authors", result['paper_authors'][1].length)
                
               // view_query_result(result, ['1', '2', '3'])
            })
        }

        function create_co_authors() {
            const num_records = document.getElementById('inputSuccess').value;
            const topic = document.getElementById('journal').value;
            fetch("http://127.0.0.1:5000/create_co_authors", {
                method: 'POST',
                headers: {'Content-Type': 'application/json',
                        "Access-Control-Allow-Origin": "*"
                },
                body: JSON.stringify({"num_records" : num_records, "topic" : topic})
        }).then(res => res.json())
        .then(result => {
            console.log("so luong dong tac gia:", result['co_author'][1].length)
         //   view_co_author_table(result, '1')
        })
        }

        function create_potential_co_authors() {
            const num_records = document.getElementById('inputSuccess').value;
            const level = parseInt(document.getElementById('level').value);
            const topic = document.getElementById('journal').value;
            fetch("http://127.0.0.1:5000/create_potential_co_authors", {
                method: 'POST',
                headers: {'Content-Type': 'application/json',
                        "Access-Control-Allow-Origin": "*"
                },
                body: JSON.stringify({"num_records": num_records, "level": level, "topic" : topic})
            }).then(res => res.json())
            .then(result => {
                console.log("so luong ung vien", result['last_potential'][1].length)
           //     view_potential_table(result, 1)
            })
        }

        function calculate_scores_and_label() {
            const num_records = document.getElementById('inputSuccess').value;
            const level = parseInt(document.getElementById('level').value);
            const topic = document.getElementById('journal').value;
            const weight_type = document.getElementById('weight_type').value;
            const label_type = document.getElementById('label_type').value;
            const time_slice = document.getElementById('time_slice').value;
            if (time_slice != "") {
                body = JSON.stringify({"num_records" : num_records, "level": level, "topic" : topic, "weight_type" : weight_type, "label_type" : label_type, "time_slice" : time_slice})
            }
            else {
                body = JSON.stringify({"num_records" : num_records, "level": level, "topic" : topic, "weight_type" : weight_type, "label_type" : label_type})
            }
            fetch("http://127.0.0.1:5000/calculate_scores", {
                method: 'POST',
                headers: {'Content-Type': 'application/json',
                        "Access-Control-Allow-Origin": "*"
                },
                body: body
            }).then(res => res.json())
            .then(result => {
                console.log(result)
            })
        }

        function draw_table(data, id, column_names) {
            var html = ("<div>" + data.length + "</div>")   
            var keys = [];
            var html = ("<table border==\"1\"><tr>");
            for (var i = 0; i < column_names.length; i++) {
	            html += ('<td>' + column_names[i] + '</td>');
            }
            html += ("</tr>");
            for (var i = 0; i < data.length; i++) {
                html += ('<tr>');
                for (key in data[i]) {
                html += ('<td>' + data[i][key] + '</td>');
            }
                html += ('</tr>');
            }
            html += ("</table>");
            document.getElementById('result' +id).innerHTML = html;
        }

        function view_query_result(data, id) {

            draw_table(data['paper'][1], id[0], data['paper'][0])
            draw_table(data['author'][1], id[1], data['author'][0])
            draw_table(data['paper_authors'][1], id[2], data['paper_authors'][0])
        }
        function view_co_author_table(data, id) {
            draw_table(data['co_author'][1], id, data['co_author'][0])
        }
        function view_potential_table(data, id) {
            draw_table(data['last_potential'][1], id, data['last_potential'][0])
        }
        function view_scores() {}


    </script>

</html>
