<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="card">
      <div class="card-header">Project III</div>
      <div class="card-body">

        <div class="form-group">
          <label for="type-journal"> Choose Topic of Journal</label> <br />

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="topic1"
              value="21"
            />
            <label for="topic1"> Biophysical Journal</label><br />

            <input
              class="form-check-input"
              type="checkbox"
              id="topic2"
              value="22"
            />
            <label for="topic2"> Journal of Molecular Biology</label><br />

            <input
              class="form-check-input"
              type="checkbox"
              id="topic3"
              value="23"
            />
            <label for="topic3"> Chemical Physics Letters</label><br />

            <input
              class="form-check-input"
              type="checkbox"
              id="topic4"
              value="24"
            />
            <label for="topic4">
              Biochemical and Biophysical Research Communications</label
            ><br />
          </div>
        </div>

        <div class="form-group">
          <button
            type="button"
            class="btn btn-outline-primary w-25"
            onclick="save_topics()"
          >
            Save topics
          </button>
        </div>
        <div class="form-group" id="dates_of_topics"></div>

        <!-- <div class="form-group">
          <label for="NumberOfRecords">Number Records</label>
          <input
            type="number"
            class="form-control"
            id="NumberRecords"
            placeholder="Enter..."
          />
        </div> -->

        <div class="form-group">
          <label for="from_date">Choose year from </label>
          <input
            type="number"
            class="form-control w-25"
            id="fromDate"
            placeholder="From year..."
          />
        </div>
        <div class="form-group">
          <label for="to_date">To year</label>
          <input
            type="number"
            class="form-control w-25"
            id="toDate"
            placeholder="To year..."
          />
        </div>

        <div class="form-group">
          <button type="button" class="btn btn-primary w-25" onclick="query()">
            Query papers, authors, paper-author
          </button>

          <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
            <a class="dropdown-item" href="#">Random</a>
            <a class="dropdown-item" href="#">Normal</a>
          </div>
        </div>
        <div class="form-group">
          <button
            type="button"
            class="btn btn-primary w-25"
            onclick="create_co_authors()"
          >
            Create co-authors table
          </button>
        </div>

        <div class="form-group">
          <label for="">Level of Potential co-authorship</label>
          <br />
          <div
            class="btn-group btn-group-toggle w-25"
            id="level"
            data-toggle="buttons"
          >
            <label class="btn btn-secondary active">
              <input
                type="radio"
                name="options"
                value="1"
                id="option1"
                autocomplete="off"
                checked
              />
              Level 01
            </label>
            <label class="btn btn-secondary">
              <input
                type="radio"
                name="options"
                value="2"
                id="option2"
                autocomplete="off"
              />
              Level 02
            </label>
            <label class="btn btn-secondary">
              <input
                type="radio"
                name="options"
                value="3"
                id="option3"
                autocomplete="off"
              />
              Level 03
            </label>
          </div>
        </div>

        <div class="form-group">
          <button
            type="button"
            class="btn btn-primary w-25"
            onclick="create_potential_co_authors()"
          >
            Create potential co authors table
          </button>
        </div>

        <div class="form-group" name="weight_type" id="weight_type">
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="exampleRadios"
              id="exampleRadios1"
              value="unweighted"
              checked
            />
            <label class="form-check-label" for="exampleRadios1">
              Unweighted
            </label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="exampleRadios"
              id="exampleRadios2"
              value="weighted"
            />
            <label class="form-check-label" for="exampleRadios2">
              Weighted
            </label>
          </div>
        </div>

        <div
          class="form-group"
          name="label_type"
          id="label_type"
          onclick="show_time_slice()"
        >
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="exampleRadios2"
              id="exampleRadios3"
              value="dynamic"
              checked
            />
            <label class="form-check-label" for="exampleRadios3">
              Dynamic
            </label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="exampleRadios2"
              id="exampleRadios4"
              value="static"
            />
            <label class="form-check-label" for="exampleRadios4">
              Static
            </label>
          </div>
        </div>

        <div class="form-group d-none w-25" id="time_slice">
          <input
            type="number"
            class="form-control"
            id="year_slice"
            placeholder="Enter year..."
          />
          <br />
          <input
            type="number"
            class="form-control"
            id="month_slice"
            placeholder="Enter month..."
          />
          <br />
          <input
            type="number"
            class="form-control"
            id="day_slice"
            placeholder="Enter day..."
          />
        </div>

        <div class="form-group">
          <input class="form-control w-25" type="text" name="" id="name_file_csv" placeholder="Input name of file to export...">
          <br>
          <button
            type="button"
            class="btn btn-outline-success w-25"
            onclick="calculate_scores_and_label()"
          >
            Calculate scores
          </button>
        </div>
      </div>
      <div class="card-footer">
        <div class="form-group" id="result0"></div>
        <div class="form-group" id="result1"></div>
        <div class="form-group" id="result2"></div>
        <div class="form-group" id="result3"></div>
      </div>
    </div>
<!-- Footer -->
<footer class="page-footer font-small blue">

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">© 2020 Copyright:
    <a href="#"> DucKiller</a>
  </div>
  <!-- Copyright -->

</footer>
<!-- Footer -->  </body>

  <script>
    
    function show_time_slice() {
      // label_type = document.getElementById("label_type").value;
      const label_type = $("#label_type input[type=radio]:checked").val();
      // console.log(document.querySelector('input[name="exampleRadios"]:checked').value);
      // console.log($("#weight_type input[type=radio]:checked").val())
      // console.log(document.querySelector("input[name='options']:checked").value);
      if (label_type == "static") {
        $("#time_slice").removeClass("d-none");
        // document.getElementById("timeSlice").style.display = "block";
      } else {
        $("#time_slice").addClass("d-none");
        // document.getElementById("timeSlice").style.display = "none";
      }
    }

    function save_topics() {
      const topics = [];
      $(":checkbox:checked").each(function (i) {
        topics[i] = $(this).val();
      });
      fetch("http://127.0.0.1:5000/get_dates_of_topics", {
        method: "POST",
        body: JSON.stringify({ topics: topics }),
        headers: {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
      })
        .then((res) => res.json())
        .then((result) => {
          console.log("Những năm mà các paper đó được viết: ", result["dates"]);
          show_dates_of_topics(result["dates"]);
        });
    }
    function query() {
      //const num_records = document.getElementById("inputSuccess").value;
      const from_date = document.getElementById("fromDate").value;
      const to_date = document.getElementById("toDate").value;
      const topics = [];
      $(":checkbox:checked").each(function (i) {
        topics[i] = $(this).val();
      });
      fetch("http://127.0.0.1:5000/query", {
        method: "POST",
        body: JSON.stringify({
          topics: topics,
          from_date: from_date,
          to_date: to_date,
        }),
        headers: {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
      })
        .then((res) => res.json())
        .then((result) => {
          console.log("so luong paper", result["paper"][1].length);
          console.log("so luong author", result["author"][1].length);
          console.log(
            "so luong paper_authors",
            result["paper_authors"][1].length
          );

          //view_query_result(result, ['1', '2', '3']);
          show_query_res(
            result["paper"][1].length,
            result["author"][1].length,
            result["paper_authors"][1].length
          );
        });
    }

    function create_co_authors() {
      //const num_records = document.getElementById("inputSuccess").value;
      const topics = [];
      $(":checkbox:checked").each(function (i) {
        topics[i] = $(this).val();
      });
      const from_date = document.getElementById("fromDate").value;
      const to_date = document.getElementById("toDate").value;
      fetch("http://127.0.0.1:5000/create_co_authors", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
        body: JSON.stringify({ topics: topics, from_date: from_date, to_date: to_date }),
      })
        .then((res) => res.json())
        .then((result) => {
          console.log("so luong dong tac gia:", result["co_author"][1].length);
          //view_co_author_table(result, '1');
          show_co_author_res(result["co_author"][1].length);
        });
    }

    function create_potential_co_authors() {
      //const num_records = document.getElementById("inputSuccess").value;
      const level = Number($("#level input[type=radio]:checked").val());
      const topics = [];
      $(":checkbox:checked").each(function (i) {
        topics[i] = $(this).val();
      });
      const from_date = document.getElementById("fromDate").value;
      const to_date = document.getElementById("toDate").value;
      fetch("http://127.0.0.1:5000/create_potential_co_authors", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
        body: JSON.stringify({
          level: level,
          topics: topics,
          from_date: from_date,
          to_date: to_date
        }),
      })
        .then((res) => res.json())
        .then((result) => {
          console.log("so luong ung vien", result["last_potential"][1].length);
          //view_potential_table(result, 1);
          show_potential_res(result["last_potential"][1].length);
        });
    }

    function calculate_scores_and_label() {
      //const num_records = document.getElementById("inputSuccess").value;
      const level = Number($("#level input[type=radio]:checked").val());
      const topics = [];
      $(":checkbox:checked").each(function (i) {
        topics[i] = $(this).val();
      });
      const weight_type = $("#weight_type input[type=radio]:checked").val();
      const label_type = $("#label_type input[type=radio]:checked").val();
      const year_slice = document.getElementById("year_slice").value;
      const month_slice = document.getElementById("month_slice").value;
      const day_slice = document.getElementById("day_slice").value;
      const from_date = document.getElementById("fromDate").value;
      const to_date = document.getElementById("toDate").value;
      const csv_file_name = document.getElementById("name_file_csv").value;
      var time_slice = "";
      if (label_type == "static") {
        if (year_slice == "") {
          alert("Please enter year!");
        } else {
          time_slice += year_slice;
          if (month_slice != "") {
            time_slice += "-";
            time_slice += month_slice;
            if (day_slice != "") {
              time_slice += "-";
              time_slice += day_slice;
            }
          }
        }
      }

      if (time_slice != "") {
        body = JSON.stringify({
          level: level,
          topics: topics,
          from_date: from_date,
          to_date:to_date,
          weight_type: weight_type,
          label_type: label_type,
          time_slice: time_slice,
          csv_file_name: csv_file_name
        });
      } else {
        body = JSON.stringify({
          level: level,
          topics: topics,
          from_date: from_date,
          to_date:to_date,
          weight_type: weight_type,
          label_type: label_type,
          csv_file_name: csv_file_name
        });
      }
      fetch("http://127.0.0.1:5000/calculate_scores", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
        body: body,
      })
        .then((res) => res.json())
        .then((result) => {
          console.log(result);
          show_score_res(result["name"], result["msg"], time_slice);
        });
    }

    function draw_table(data, id, column_names) {
      var html = "<div>" + data.length + "</div>";
      var keys = [];
      html += '<table border=="1"><tr>';
      for (var i = 0; i < column_names.length; i++) {
        html += "<td>" + column_names[i] + "</td>";
      }
      html += "</tr>";
      for (var i = 0; i < data.length; i++) {
        html += "<tr>";
        for (key in data[i]) {
          html += "<td>" + data[i][key] + "</td>";
        }
        html += "</tr>";
      }
      html += "</table>";
      document.getElementById("result" + id).innerHTML = html;
    }

    function view_query_result(data, id) {
      draw_table(data["paper"][1], id[0], data["paper"][0]);
      draw_table(data["author"][1], id[1], data["author"][0]);
      draw_table(data["paper_authors"][1], id[2], data["paper_authors"][0]);
    }
    function view_co_author_table(data, id) {
      draw_table(data["co_author"][1], id, data["co_author"][0]);
    }
    function view_potential_table(data, id) {
      draw_table(data["last_potential"][1], id, data["last_potential"][0]);
    }
    function view_scores() {}
    function show_dates_of_topics(dates) {
      // content = "";
      // for (var i = 0; i < dates.length; i++) {
      //   content += dates[i];
      //   if (i < dates.length - 1) content += ", ";
      // }
      var html =
        "<div>Time interval of Topics: <br>" +
        dates[0] +
        ' <i class="fas fa-angle-double-right"></i> ' +
        dates[dates.length - 1] +
        "</div>";
      document.getElementById("dates_of_topics").innerHTML = html;
      document.getElementById("dates_of_topics").style.fontStyle = "italic";
      // document.getElementById("dates_of_topics").style.color = "blueviolet";
    }
    function show_query_res(paper_count, author_count, paper_authors_count) {
      var html = "<div>Number of paper: " + paper_count + "</div>" + "<br>";
      html += "<div>Number of author: " + author_count + "</div>" + "<br>";
      html +=
        "<div>Number of paper_author: " +
        paper_authors_count +
        "</div>" +
        "<br>";
      document.getElementById("result0").innerHTML = html;
    }
    function show_co_author_res(co_author_count) {
      var html =
        "<div>Number of co_author: " + co_author_count + "</div>" + "<br>";
      document.getElementById("result1").innerHTML += html;
    }
    function show_potential_res(potential_count) {
      var html =
        "<div>Number of potential_co_author: " +
        potential_count +
        "</div>" +
        "<br>";
      document.getElementById("result2").innerHTML += html;
    }
    function show_score_res(file_name, msg, time_slice) {
      var html =
        "<div> Correlation ratio 0 - 1 for time slice " +
        time_slice +
        ": " +
        msg[0] +
        "--" +
        msg[1] +
        "</div>" +
        "<br>";
      document.getElementById("result3").innerHTML += html;
    }
  </script>
  <script
    src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"
  ></script>
</html>
